// test-api-football.js
import fetch from 'node-fetch';

const API_FOOTBALL_KEY = process.env.API_FOOTBALL_KEY;
if (!API_FOOTBALL_KEY) {
  console.error("‚ùå Missing API_FOOTBALL_KEY in environment variables");
  process.exit(1);
}

const PREMIER_LEAGUE_ID = 39;
const SEASON = 2024; // Current season

async function testFixtures() {
  const today = new Date();
  const nextMonth = new Date();
  nextMonth.setDate(today.getDate() + 30);

  const fromDate = today.toISOString().split('T')[0];
  const toDate = nextMonth.toISOString().split('T')[0];

  const url = `https://v3.football.api-sports.io/fixtures?league=${PREMIER_LEAGUE_ID}&season=${SEASON}&from=${fromDate}&to=${toDate}`;

  console.log(`üîç Testing API-Football request: ${url}`);

  try {
    const res = await fetch(url, {
      headers: { 'x-apisports-key': API_FOOTBALL_KEY },
    });

    if (!res.ok) {
      throw new Error(`HTTP error ${res.status}: ${res.statusText}`);
    }

    const data = await res.json();
    console.log(`‚úÖ Fixtures fetched: ${data.response.length}`);
    console.log(JSON.stringify(data.response, null, 2));

    if (data.response.length === 0) {
      console.log("‚ö†Ô∏è No fixtures found ‚Äî possibly an international break or wrong season/year.");
    }

  } catch (err) {
    console.error("‚ùå Error fetching fixtures:", err.message);
  }
}

testFixtures();
