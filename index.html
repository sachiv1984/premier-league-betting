<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Premier League Betting Analysis</title>
<style>
  body {
    font-family: Arial, sans-serif;
    margin: 2rem;
    background: #f7f7f7;
    color: #333;
  }
  table {
    border-collapse: collapse;
    width: 100%;
    margin-bottom: 2rem;
  }
  th, td {
    border: 1px solid #ccc;
    padding: 0.5rem 1rem;
    text-align: left;
  }
  th {
    background: #004080;
    color: white;
  }
  tr:hover {
    background: #e1f0ff;
  }
  h1 {
    margin-bottom: 1rem;
  }
  .loading {
    font-style: italic;
    color: #666;
  }
</style>
</head>
<body>
  <h1>Premier League Upcoming Fixtures & Odds</h1>
  <div id="content">
    <p class="loading">Loading data...</p>
  </div>

<script>
async function loadData() {
  try {
    const [fixturesRes, oddsRes] = await Promise.all([
      fetch('./upcoming-fixtures.json'),
      fetch('./odds.json')
    ]);
    if (!fixturesRes.ok || !oddsRes.ok) throw new Error('Failed to fetch data');

    const fixturesData = await fixturesRes.json();
    const oddsData = await oddsRes.json();

    displayData(fixturesData, oddsData);
  } catch (e) {
    document.getElementById('content').innerHTML = '<p>Error loading data.</p>';
    console.error(e);
  }
}

function displayData(fixtures, odds) {
  if (!fixtures.length) {
    document.getElementById('content').innerHTML = '<p>No upcoming fixtures found.</p>';
    return;
  }

  const contentDiv = document.getElementById('content');
  contentDiv.innerHTML = '';

  const table = document.createElement('table');
  const thead = document.createElement('thead');
  thead.innerHTML = `
    <tr>
      <th>Date</th>
      <th>Time (UTC)</th>
      <th>Home Team</th>
      <th>Away Team</th>
      <th>Odds (H / D / A)</th>
    </tr>`;
  table.appendChild(thead);

  const tbody = document.createElement('tbody');

  // Map odds by fixture id or teams (depends on your odds JSON structure)
  // This example assumes odds have a "matchup" property "HomeTeam vs AwayTeam"
  const oddsMap = new Map();
  for (const matchOdds of odds) {
    // Adjust keys depending on your odds JSON format
    // Here is an example key:
    const key = `${matchOdds.home_team} vs ${matchOdds.away_team}`;
    oddsMap.set(key.toLowerCase(), matchOdds);
  }

  for (const fixture of fixtures) {
    const dateObj = new Date(fixture.fixture.date);
    const dateStr = dateObj.toISOString().split('T')[0];
    const timeStr = dateObj.toISOString().split('T')[1].substring(0,5);

    const home = fixture.teams.home.name;
    const away = fixture.teams.away.name;

    const key = `${home} vs ${away}`.toLowerCase();
    const matchOdds = oddsMap.get(key);

    let oddsDisplay = 'N/A';
    if (matchOdds && matchOdds.bookmakers?.length) {
      // Get odds from the first bookmaker for H2H market
      const h2hMarket = matchOdds.bookmakers[0].markets.find(m => m.key === 'h2h');
      if (h2hMarket) {
        const outcomes = h2hMarket.outcomes;
        const homeOdds = outcomes.find(o => o.name.toLowerCase() === home.toLowerCase())?.price || '-';
        const drawOdds = outcomes.find(o => o.name.toLowerCase() === 'draw')?.price || '-';
        const awayOdds = outcomes.find(o => o.name.toLowerCase() === away.toLowerCase())?.price || '-';
        oddsDisplay = `${homeOdds} / ${drawOdds} / ${awayOdds}`;
      }
    }

    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td>${dateStr}</td>
      <td>${timeStr}</td>
      <td>${home}</td>
      <td>${away}</td>
      <td>${oddsDisplay}</td>
    `;
    tbody.appendChild(tr);
  }
  table.appendChild(tbody);
  contentDiv.appendChild(table);
}

loadData();
</script>
</body>
</html>
